# Парсер ERZRF.ru - ТОП-250 застройщиков России

Этот проект содержит парсер для сайта erzrf.ru, который извлекает данные о топ-250 застройщиках России.

## Что извлекает парсер

Для каждой компании парсер извлекает:
- **Название** компании
- **Город** (местоположение)
- **Сайт** (официальный веб-сайт)
- **Соцсети** (ссылки на социальные сети)
- **URL карточки** (ссылка на страницу компании на erzrf.ru)

## Файлы проекта

### Основные парсеры:
- `final_erzrf_parser.py` - **ОСНОВНОЙ ПАРСЕР** для полного парсинга всех 250 компаний
- `erzrf_improved_parser.py` - Улучшенная версия парсера с лучшей логикой извлечения данных
- `erzrf_hybrid_parser.py` - Гибридный парсер (requests + requests-html)

### Тестовые скрипты:
- `test_improved_parser.py` - Тест для улучшенного парсера
- `test_hybrid_parser.py` - Тест для гибридного парсера
- `debug_company_page.py` - Отладочный скрипт для изучения структуры страниц

### Вспомогательные файлы:
- `erzrf_parser.py` - Первоначальная версия парсера (только requests)
- `erzrf_selenium_parser.py` - Версия с Selenium (требует Chrome)
- `erzrf_requests_html_parser.py` - Версия с requests-html

## Установка зависимостей

```bash
pip install requests beautifulsoup4 lxml pandas requests-html openpyxl lxml_html_clean
```

Также потребуется установить Chromium для pyppeteer:
```bash
pyppeteer-install
```

## Использование

### Быстрый запуск (рекомендуется)

Для парсинга всех 250 компаний запустите основной парсер:

```bash
python3 final_erzrf_parser.py
```

### Тестирование на небольшом количестве компаний

Для тестирования на 3-5 компаниях:

```bash
python3 test_improved_parser.py
```

## Как работает парсер

1. **Сбор ссылок**: Парсер проходит по страницам топа застройщиков (1-15 страниц, по 20 компаний на каждой)
2. **Извлечение ссылок**: Использует BeautifulSoup для извлечения ссылок на карточки компаний
3. **Парсинг карточек**: Для каждой компании использует requests-html с рендерингом JavaScript
4. **Извлечение данных**: Применяет множественные стратегии для поиска названия, сайта, города и соцсетей
5. **Сохранение**: Сохраняет данные в Excel и CSV форматах

## Особенности

- **Рендеринг JavaScript**: Использует pyppeteer для корректной обработки Angular-приложения
- **Множественные стратегии**: Применяет несколько методов поиска для каждого типа данных
- **Фильтрация**: Исключает нерелевантные ссылки (метрика, соцсети портала и т.д.)
- **Промежуточное сохранение**: Сохраняет данные каждые 20 компаний
- **Обработка ошибок**: Повторные попытки и сохранение неудачных URL

## Результаты

Парсер создает следующие файлы:
- `erzrf_companies_final.xlsx` - Основной результат в Excel
- `erzrf_companies_final.csv` - Основной результат в CSV
- `companies_backup_X.xlsx` - Промежуточные сохранения
- `failed_urls.txt` - Список URL, которые не удалось обработать

## Структура данных

| Столбец | Описание | Пример |
|---------|----------|--------|
| название | Название компании | ПИК, ГК Самолет |
| город | Город/регион | Москва, Санкт-Петербург |
| сайт | Официальный сайт | https://www.pik.ru/ |
| соцсети | Социальные сети | https://vk.com/pik_ru |
| url_карточки | Ссылка на карточку | https://erzrf.ru/zastroyschiki/brand/... |

## Примечания

- Парсинг всех 250 компаний занимает примерно 2-3 часа
- Между запросами установлены паузы для избежания блокировки
- Некоторые компании могут не иметь всех данных (это нормально)
- Парсер автоматически исключает служебные ссылки портала

## Решение проблем

Если парсер не работает:
1. Убедитесь, что установлены все зависимости
2. Проверьте интернет-соединение
3. Запустите тестовый скрипт для диагностики
4. Проверьте, что сайт erzrf.ru доступен

## Автор

Парсер создан для извлечения публично доступной информации с сайта erzrf.ru в соответствии с robots.txt и условиями использования.